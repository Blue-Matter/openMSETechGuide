```{r}
#| eval: true
#| include: false
#| message: false
#| warning: false
#| cache: false
library(MSEtool)
knitr::read_chunk('../MSEtool/data-raw/ExampleOM.R')
```

# Build a `Stock` Object {#sec-stock_build}

A `Stock` object contains the information related the biological characteristics of a stock, including growth and maturity schedules, natural mortality rates, stock-recruitment relationship, and other information relating to spatial distribution and movement patterns (see `?Stock` for more details).

Here an example `Stock` object is created using an expert judgment approach, where most parameters are stochastic.

The stock is loosely based on albacore *Thunnus alalunga* and should only be considered an example for demonstration purposes.

Later, this `Stock` object will be added to the `OM` object created in the previous chapter.

The `Stock()` function is used to create new `Stock` objects:

```{r initialize-stock}
```

In addition to `Name`, `CommonName`, and `Species` that were specified in the call to the `Stock()` function, `Stock` objects contain several other sub-objects that need to be populated:

1.  `Ages`
2.  `Length`
3.  `Weight`
4.  `NaturalMortality`
5.  `Maturity`
6.  *`Fecundity`*
7.  `SRR`
8.  *`Spatial`*
9.  *`Depletion`*

The sub-objects in italics are optional, see the sections below for details. The other sub-objects must be populated to complete the `Stock` object.

::: callout-tip
## Help Documentation

Help documentation can be accessed for all `openMSE` objects and functions, e.g.,

```{r}
#| eval: false
?OM
?Stock
?Ages
?Length
# etc
```
:::

## Ages

An `Ages` object contains information relating to the age structure of the stock.

```{r create-ages_1}
```

Note that `MaxAge` is set in time units of `quarter`. It is important that the time units in the `Ages` object matches the number of seasons in the `OM`.

Also note that, following the convention in `Years(OM)` the age classes are *always* in units of year:

```{r classes-ages}
```

To keep things simple, we'll change our `OM` back to annual time-steps and re-recreate the `Ages` object accordingly:

```{r create-ages_2}
```

## Length

The `Length` object describes the mean length-at-age schedule and how length-at-age is distributed around the mean. This information is primarily used for two purposes:

1.  Calculating mean weight-at-age from a length-weight relationship a the mean length-at-age
2.  Calculating the age-length key for converting at-age values (such as maturity-at-age) to at-length (i.e., maturity-at-length) and vice versa, and for generating catch-at-length data.

::: callout-note
The `Length` object is optional if no other objects are a function of length (e.g., `Weight`, `Maturity`, `Fecundity` and `Selectivity` etc in the `Fleet` object, and there is no requirement to generate catch-at-length data.
:::

The `Length()` function is used to create `Length` objects. The help documentation for this function (`?Length`) provides details on the contents of the `Length` object and a description of the arguments for the `Length()` function (@fig-length_help).

![Screenshot of the help documentation for the `Length` function](images/Length_help.png){#fig-length_help width="60%"}

Ultimately, users must provide information to populate `MeanAtAge` and `CVatAge` in a `Length` object. `MeanAtAge` is common to all objects that contain at-age information, and, as the name suggests, contains information describing the mean at-age schedule (in this case the mean length-at-age). `CVatAge` contains the coefficient of variability for the distribution of length-at-age, which can be either normally (`Dist='normal'`) or log-normally (`Dist='lognormal'`) distributed around `MeanAtAge`.

Internally, both `MeanAtAge` and `CVatAge` will be 3-dimensional arrays with dimensions containing values for each simulation, age-class, and historical and projection time step (typically years but as noted above, for seasonal models the time steps will actually be decimal years). However, the `openMSE` objects have been designed such that users only need to enter the minimal information to populate the model.

In this example, the values for `MeanAtAge` are defined by means of a list of named parameters (`Pars`) for a built-in growth function (`vonBert`):

```{r create-length}

```

The parameters for the `vonBert` function and the values for `CVatAge` are entered as lower and upper bounds of a uniform distribution. Internally, `nSim` values for the `Linf`, `K`, and `t0` parameters will be sampled from uniform distributions, and these used to calculate the values for `MeanAtAge`. Similarly, `nSim` values will be sampled for `CVatAge`.

This is done internally by the `Populate` function, which is run here on the `Length` object to demonstrate:

```{r populate-length}

```

Notice that, because in this object mean length-at-age is constant over time, while `MeanAtAge` is a 3-dimensional array, the third dimension (`Year`) is only length 1 and named as the first historical year. Similarly, while `CVatAge` is a 3-dimensional array, the dimensions `Age` and `Year` are only length 1 and named as the first age-class and year respectively. Internally, these array will be expanded out for all age-classes and years.

There are several other ways to specify values for `Pars`, `MeanAtAge`, and `CVatAge`, including using alternative growth functions, and specifying values that vary over time and/or ages. These methods are discussed in more detail in @sec-object_length.

## Weight

The `Weight` object contains information related to the weight-at-age and/or the length-weight relationship. In this example, an allometric length-weight relationship with parameters `alpha` and `beta` is specified, with values that are constant over all simulations and time-steps:

```{r create-weight}
```

Internally, the `Populate` function will be used to calculate the mean weight-at-age from the `alpha` and `beta` parameters and the length defined in the `Length` object.

@sec-object_weight has more details on the `Weight` object.

## NaturalMortality

The `NaturalMortality` object contains information relating to the natural mortality rate for each age-class and time step:

```{r create-natural-mortality }
```

In this example, `M` is specified as a named parameter in the `Pars` list, with the values indicating lower and upper bounds of a uniform distribution. The second element in `Pars` is `Msd`, with values also indicating lower and upper bounds of a uniform distribution. The `Msd` parameter indicates the standard deviation of log-normally distributed process error which is used as a simple method to add stochastic time-varying variation to `M` :

```{r populate-M}

```

@sec-object_natural_mortality has more details on the `NaturalMortality` object.

## Maturity

`Maturity` objects contain information related to the probability that a specific age- and/or length-class is mature. This example uses a 2-parameter logistic function to specify the probability of maturity-at-length, once again using lower and upper bounds of a uniform distribution to account for uncertainty:

```{r create-maturity}

```

In this example, parameters in `Pars` are used to calculate `MeanAtLength` , which is then used together with the age-length key described in the `Length` object to calculate the values for `MeanAtAge` :

```{r populate-maturity}

```

@sec-object_maturity has more details on the `Maturity` object.

## Fecundity

The `Fecundity` object contains information describing the fecundity (e.g., egg production) -at-age schedule. `Fecundity` is optional in a `Stock` object. If it is missing, fecundity-at-age is assumed to be proportional to spawning biomass-at-age (i.e., maturity-at-age multiplied by weight-at-age).

This `ExampleStock` object follows this assumption and leaves the `Fecundity` object empty.

@sec-object_fecundity has more details on the `Fecundity` object.

## SRR

`SRR` objects describe the relationship between spawning production and resulting recruitment. The `SRR` object also contains data on unfished recruitment (`R0`), and the recruitment deviations for the historical and projection years.

This example uses the Beverton-Holt stock-recruit model (specified by the named parameter `h` in `Pars`; see `SRRModels()` for other options):

```{r create-srr}

```

`R0` is specified as a single value, indicating that it is constant over all simulations and years. `SD` and `AC` are specified as stochastic parameters from a uniform distribution, representing the standard deviation and the lag-1 autocorrelation respectively of the log-normally distributed process errors..

@sec-object_srr has more details on the `SRR` object.

## Spatial

`Spatial` objects are only required if an `OM` has spatial structure.

@sec-object_spatial has more details on the `Spatial` object.

## Depletion

@sec-object_depletion has more details on the `Depletion` object.
